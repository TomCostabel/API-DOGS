import React, { useEffect, useState } from "react";
import { useDispatch } from "react-redux";
import { getAllDogs } from "../../redux/actions";
import DogCard from "../DogCard/DogCard";
import "../Dogs/Dogs.css";
import Pagination from "../Pagination/Pagination";
import axios from "axios";
import NavBar from "../NavBar/NavBar";

const Dogs = () => {
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////--MIS STATES--//////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    const [datosFromApi, setDatosFromApi] = useState([]);

    const [actualDogs, setActualDogs] = useState([]);

    const [currentPage, setCurrentPage] = useState(0);

    const [loading, setLoading] = useState(false);

    const ITEMS_X_PAGE = 8;

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////--LLAMADOS--////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    useEffect(() => {
        const fetchPosts = async () => {
            setLoading(true);
            const res = await axios.get(
                "https://api.thedogapi.com/v1/breeds?api_key=0f2efe03-3eee-449e-9d0d-4524a73230e6"
            );
            setDatosFromApi(res.data);
            setLoading(false);
        };
        fetchPosts();
    }, []);

    const dispatch = useDispatch();
    useEffect(() => {
        if (!datosFromApi.length) dispatch(getAllDogs());
        setActualDogs(
            [...datosFromApi].slice(
                currentPage * ITEMS_X_PAGE,
                currentPage * ITEMS_X_PAGE + ITEMS_X_PAGE
            )
        );
    }, [dispatch, datosFromApi]);

    console.log("esto es actual dog", actualDogs);
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////--NEXT HANDLER--////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    const nextHandler = () => {
        const totalElementos = datosFromApi.length;

        const nextPage = currentPage + 1;

        const firstIndex = nextPage * ITEMS_X_PAGE;

        if (firstIndex === totalElementos) return;
        // if (nextPage > 22) return;

        setActualDogs(
            [...datosFromApi].slice(firstIndex, firstIndex + ITEMS_X_PAGE)
        );
        setCurrentPage(nextPage);
    };

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////--PREV HANDLER--////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    const prevHandler = () => {
        const prevPage = currentPage - 1;

        if (prevPage < 0) return;

        const firstIndex = prevPage * ITEMS_X_PAGE;

        setActualDogs(
            [...datosFromApi].slice(firstIndex, firstIndex + ITEMS_X_PAGE)
        );
        setCurrentPage(prevPage);
    };

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////--MAPEO ITEMS X PAGE --//////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    const perritos = actualDogs.map((e) => {
        return (
            <DogCard
                key={e.id}
                id={e.id}
                image={e.image.url}
                name={e.name}
                temperament={e.temperament}
                peso={e.weight.metric}
            />
        );
    });
    console.log("array de perros", actualDogs);
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////--RETURN--/////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    if (actualDogs.length < 1)
        return (
            <div>
                <NavBar />
                <h1>Loading...</h1>
            </div>
        );
    return (
        <div>
            <NavBar />
            <div>
                <Pagination
                    nextHandler={nextHandler}
                    items={perritos}
                    prevHandler={prevHandler}
                    currentPage={currentPage}
                />
            </div>
        </div>
    );
};

export default Dogs;
